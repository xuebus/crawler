<docs table="dianping_city_region_merchant_href">
    <!--你可以使用Jsoup内置的CSS SELECTOR、正则、json进行抽取，
    我们会将其转换成语义树-->

    <!--一个doc对应一个网页,url表示网页-->
    <doc docid="dianping_city"
         url="http://www.dianping.com/ajax/json/index/citylist/getCitylist?do=allCitylist&amp;_nr_force=1439875530364"
         method="get" firstdoc="true" table="dianping_city_region_20151009"  >

        <list jsonselector="msg->html" name="result" >
        	<text name="cityName" seprator="|" index="0" />
        	<text name="citySpell" seprator="|" index="1" />
        	<text name="cityShortSpell" seprator="|" index="2" />
            <text name="cityid" parameter="true" seprator="|" index="3" />
            <str name="regionLevel" value="1" />
            <str name="step" value="1" />
        </list>
        <ref docid="dianping_city_region"/>
    </doc>

    <!--
     http://www.dianping.com/search/category/${cityid}/10#nav-tab|0|1
     http://www.dianping.com/search/category/${cityid}/10#nav-tab%7c0%7c1
     -->
     <doc docid="dianping_city_region" url="http://www.dianping.com/search/category/${cityid}/10" table="dianping_city_region_20151009"  method="get" >
        <list selector="div#region-nav a" name="result" isfield="false"  filterNot="更多">
            <text name="regionName" selector="span" />
            <text name="cityName" selector="div#page-header a.city.J-city" useContext="true" />
            <attr attr="href" name="regionHref" parameter="true"/>
            <str name="regionLevel" value="2" />
            <str name="step" value="2" />
        </list>
        <ref docid="dianping_city_region_sub"/>
    </doc>
    
    <!-- url="http://www.dianping.com${regionHref}"  http://www.dianping.com/search/category/1311/10/r49949-->
    <doc docid="dianping_city_region_sub" url="http://www.dianping.com${regionHref}" table="dianping_city_region_20151009"  method="get" firstdoc="false" >
        <list selector="div#region-nav-sub a" name="result" isfield="false"  filterNot="不限">
            <text name="regionName" selector="span" />
            <text name="parentRegionName" selector="div#region-nav a.cur span" useContext="true" />
            <text name="cityName" selector="div#page-header a.city.J-city" useContext="true" />
            <str name="regionLevel" value="3" />
            <attr name="parentRegionHref" selector="div#region-nav a.cur" attr="href"  useContext="true" />
            <attr attr="href" name="regionHref" parameter="true" needCache128="true" filterregex="([\w/]+)#" filterGroup="1" />
            <str name="step" value="3" />
        </list>
          <text selector="body#top div.section.Fix div.bread.J_bread span.num" name="total" filterRegex="(\d+)" filterGroup="1" notsave="true" />
        <ref docid="dianping_city_region_sub_tmp"/>
    </doc>
    
      <doc docid="dianping_city_region_sub_tmp" url="http://www.dianping.com${regionHref}" >
        <text  name="regionHref" value="${regionHref}" parameter="true"  notsave="true" />
        <text selector="body#top div.section.Fix div.bread.J_bread span.num" name="total" filterRegex="(\d+)" filterGroup="1" notsave="true" />
        <ref docid="dianping_merchant_list_firstpage"/>
    </doc>
 <!-- 
 		firsturl="http://www.dianping.com/${regionHref}" 
 		url="http://www.dianping.com${regionHref}p${page}"
 -->
    <doc docid="dianping_merchant_list_firstpage" firsturl="http://www.dianping.com/${regionHref}"
 		 	url="http://www.dianping.com${regionHref}p${page}"
 		 	method="get" page="true" maxPage="50" pagesize="15" firstPageSize="17">
        <list selector="div.content-wrap div.shop-wrap div.content div.shop-list.J_shop-list.shop-all-list ul li" name="result">
            <attr attr="href" name="merchantHref" parameter="true" selector="div.pic a"  notsave="true"/>
            <str name="step" value="4"  notsave="true" /> 
           	<str name="test_context" value="4" needCache128="true"  notsave="true" />
        	<text name="sum" selector="body#top div.section.Fix div.bread.J_bread span.num" filterRegex="(\d+)" filterGroup="1"  useContext="true"  notsave="true"/> 
        </list>
        <!--  if there is no total item number, you also can use totalpagesize-->
       <ref docid="dianping_merchant_detail"/>
    </doc> 

<!-- url="http://www.dianping.com${merchantHref}"   url="http://www.dianping.com/shop/4119822" -->
    <doc docid="dianping_merchant_detail" url="http://www.dianping.com${merchantHref}"  table="dianping_city_region_merchant_20151009" firstdoc="false" >
     	<attr name="shopId" attr="href" selector="div#basic-info div.action a.report" filterRegex="(\d+)" filterGroup="1" />
        <text name="tel" 				selector="div.body-content.clearfix div.main div#basic-info p.expand-info.tel span.item" type="multiple" seprator="|"/>
        <text name="shopName" 			selector="div#body div.breadcrumb span" />
        <text name="address" 			selector="div#body div.body-content div#basic-info div.expand-info.address span.item" />
        <text name="businessHours" 		selector="div#basic-info p.info.info-indent span.info-name:contains(营业时间) + span.item" /> 
        <list name="branchshopIds" 		selector="div#shop-branchs div.item a" isfield="true" >
           <attr attr="href" name="branchshopId"  filterRegex="(\d+)" filterGroup="1" />
        </list>
        <text name="averageCost" 		selector="div#basic-info div.brief-info span:contains(人均)" />
        <text name="tasteScore" 		selector="div#basic-info div.brief-info span:contains(口味)" />
        <text name="enviromentScore" 	selector="div#basic-info div.brief-info span:contains(环境)" />
        <text name="serviceScore" 		selector="div#basic-info div.brief-info span:contains(服务)" /> 
        <attr name="cityId" 			selector="input#G_s" attr="data-s-cityid" /> 
        <text name="regionName" 		selector="div#basic-info div.expand-info.address span.info-name + a span" /> 
        <text name="canBooking" 		selector="a#reservation-icon" ifExist="1" default="0" />
        <text name="tags"				selector="div#basic-info.basic-info div.other p.info.info-indent span.item a"   type="multiple" seprator="|" />
        <text name="canSwingCard" 		selector="div#basic-info.basic-info div.other p.info.info-indent span.item a:contains(可以刷卡)" ifExist="1" default="0" />
        <attr name="starRank" 			selector="div#basic-info.basic-info div.brief-info span.mid-rank-stars" attr="title"/>
      	<text name="traffic" 			regex="(traffic:.+)"/>
      	<text name="longitude" 			regex="(\{lng:.+,lat:.+\d\})" jsonselector="lng" regexGroup="1"/>
      	<text name="latitude" 			regex="(\{lng:.+,lat:.+\d\})" jsonselector="lat" regexGroup="1" />
      	<list name="dishList" 	regex="&lt;script\stype=&quot;text/panel&quot;\sclass=&quot;J-panels&quot;&gt;([\s\S]*)&lt;/script&gt;"	group="1" selector="ul.recommend-photo li.item" isfield="true" >
      		<attr 	selector="img" 			name="picLink"	attr="src" replace="120c90 -> 700c700"/>
      		<text 	selector="p.name" 		name="name" />
      		<text 	selector="span.price" 	name="price" />
      	</list>
        <str name="step" value="5" />
      	<attr name="categoryAndRegionHref" 	attr="href" selector="div.breadcrumb a" last="true"/> 
    </doc>

    <!--post test-->
    <!--<doc docid="dipingdetail" url="http://www.dianping.com/${href}">
        <post>
            <str name="a" value="haha" notsave="true"/>   [default notsave=false ]
            <str name="title" notsave="true">${page}</str>
        </post>
    </doc>-->

</docs>